{% extends './base.html' %}
{% load i18n %}
{% block structure %}{{ block.super }}<!--       ui/check_list_update -->
{% endblock %}

{% block content %}
    <options>
        <option-item v-for="choice, index in choices" :key="choice.value"
                     :title="choice[1]"
                     :name="property"
                     :value="choice[0]"
                     :id="index"></option-item>
    </options>
{% endblock %}

{% block js %}{{ block.super }}
    <!-- üíô ui/check_list_update -->
    <script>
        const vm = new Vue({
            mixins: [base, patch],
            el: '#content',
            data: {
                property: undefined, value: undefined, newValue: undefined, choices: []
            },
            updated() { // ÁªÑ‰ª∂ÊåÇËΩΩ‰πãÂêé
                document.querySelectorAll('input').forEach(it => {
                    if (it.attributes['type'].value === 'radio') {
                        // SO: https://stackoverflow.com/questions/11973678/difference-between-element-value-and-element-getattributevalue
                        if (this.value.toString() === it.value) {
                            it.setAttribute('checked', 'checked')
                        }
                        it.onclick = event => {
                            this.newValue = it.value
                            if (this.value.toString() === this.newValue) { // === Êó†Ê≥ïÂà§Êñ≠Êï∞Â≠ó
                                console.warn('‰∏é‰πãÂâçÁõ∏Âêå, ‰∏çÊèê‰∫§ÊúçÂä°Âô®Êõ¥Êñ∞')
                                // history.back() // Âè™ËøîÂõû‰∏çÂà∑Êñ∞
                            } else {
                                this.submit()
                            }
                        }
                    }
                })
            },
            methods: {
                onPrepare() {
                    const url = new URL(document.URL)
                    const resource = url.searchParams.get('resource')
                    const property = url.searchParams.get('property')
                    if (!resource || !property) {
                        showAlert('ËØ∑‰º†ÂÖ• resource Âíå property')
                        return
                    }
                    // Âä®ÊÄÅËé∑ÂèñÂèÇÊï∞
                    httpUtilrequest('GET', '/api/v1/choices/', {
                        'resource': resource,
                        'property': property
                    }, (code, data) => {
                        this.call.method = data.method
                        this.call.endpoint = data.endpoint
                        this.property = data.property.name
                        this.value = data.property.value
                        this.choices = data.property.choices
                    })
                },
                onSubmit() {
                    this.params = {[this.property]: this.newValue}
                },
                onLoadSuccess(code, data) { // ÈªòËÆ§Ê®°ÂºèÊòØËøîÂõû
                    this.value = this.newValue
                    // history.back()
                    // location.replace(endpoint.replace('/api/v1/', '/'))
                }
            }
        })
    </script>
    <!-- üíõ Ëá™ÂÆö‰πâ js -->{% endblock %}
